<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conditions Portal - Data Models</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700;800&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
  <style>
    :root {
      --bg-primary: #0a0f1a;
      --bg-secondary: #111827;
      --bg-card: #1a2234;
      --accent-blue: #3b82f6;
      --accent-teal: #14b8a6;
      --accent-amber: #f59e0b;
      --text-primary: #f1f5f9;
      --text-secondary: #94a3b8;
      --text-muted: #64748b;
      --border-subtle: rgba(255,255,255,0.08);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Plus Jakarta Sans', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      padding: 60px 80px;
      line-height: 1.6;
    }

    body::before {
      content: '';
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(ellipse at 20% 20%, rgba(59, 130, 246, 0.08) 0%, transparent 50%),
        radial-gradient(ellipse at 80% 80%, rgba(20, 184, 166, 0.06) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .container {
      position: relative;
      z-index: 1;
      max-width: 1200px;
      margin: 0 auto;
    }

    .breadcrumb {
      background: var(--bg-card);
      padding: 15px 30px;
      border-radius: 8px;
      margin-bottom: 3rem;
      font-size: 0.9em;
      border: 1px solid var(--border-subtle);
    }

    .breadcrumb a {
      color: var(--accent-blue);
      text-decoration: none;
      transition: color 0.2s;
    }

    .breadcrumb a:hover {
      color: var(--accent-teal);
    }

    .breadcrumb .separator {
      margin: 0 10px;
      color: var(--text-muted);
    }

    .breadcrumb .current {
      color: var(--text-secondary);
    }

    .label {
      font-family: 'JetBrains Mono', monospace;
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.15em;
      color: var(--accent-blue);
      margin-bottom: 1rem;
      font-weight: 500;
    }

    h1 {
      font-size: 3rem;
      font-weight: 800;
      line-height: 1.1;
      letter-spacing: -0.03em;
      margin-bottom: 1rem;
    }

    .subtitle {
      font-size: 1.15rem;
      color: var(--text-secondary);
      margin-bottom: 3rem;
    }

    h2 {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--accent-teal);
      margin: 3rem 0 1.5rem 0;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid var(--border-subtle);
    }

    h3 {
      font-size: 1.4rem;
      font-weight: 600;
      color: var(--text-primary);
      margin: 2rem 0 1rem 0;
    }

    /* ERD Diagram Styles */
    .erd-container {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 3rem;
      margin: 3rem 0;
      overflow-x: auto;
    }

    .erd-title {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent-teal);
      margin-bottom: 2rem;
      text-align: center;
    }

    .erd-legend {
      display: flex;
      justify-content: center;
      gap: 2rem;
      margin-bottom: 2rem;
      padding: 1rem;
      background: rgba(59, 130, 246, 0.05);
      border-radius: 8px;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .legend-box {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      border: 2px solid;
    }

    .legend-box.byte {
      background: rgba(59, 130, 246, 0.2);
      border-color: var(--accent-blue);
    }

    .legend-box.portal {
      background: rgba(20, 184, 166, 0.2);
      border-color: var(--accent-teal);
    }

    .legend-box.hybrid {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.3) 0%, rgba(20, 184, 166, 0.3) 100%);
      border-color: var(--accent-amber);
    }

    .erd-svg {
      width: 100%;
      height: auto;
      min-height: 600px;
    }

    /* System Architecture Info */
    .architecture-info {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(20, 184, 166, 0.1));
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 12px;
      padding: 2rem;
      margin: 2rem 0;
    }

    .architecture-info h4 {
      color: var(--accent-teal);
      margin-bottom: 1rem;
      font-size: 1.2rem;
    }

    .architecture-info ul {
      list-style: none;
      padding-left: 0;
    }

    .architecture-info li {
      padding: 0.5rem 0;
      padding-left: 1.5rem;
      position: relative;
      color: var(--text-secondary);
    }

    .architecture-info li::before {
      content: '‚Üí';
      position: absolute;
      left: 0;
      color: var(--accent-blue);
      font-weight: bold;
    }

    /* System Badges */
    .system-badges {
      display: flex;
      gap: 0.75rem;
      margin-bottom: 1.5rem;
      flex-wrap: wrap;
    }

    .system-badge {
      display: inline-block;
      padding: 0.4rem 0.8rem;
      border-radius: 6px;
      font-size: 0.75rem;
      font-family: 'JetBrains Mono', monospace;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      border: 2px solid;
    }

    .system-badge.byte {
      background: rgba(59, 130, 246, 0.15);
      border-color: var(--accent-blue);
      color: var(--accent-blue);
    }

    .system-badge.portal {
      background: rgba(20, 184, 166, 0.15);
      border-color: var(--accent-teal);
      color: var(--accent-teal);
    }

    .system-badge.hybrid {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.2), rgba(20, 184, 166, 0.2));
      border-color: var(--accent-amber);
      color: var(--accent-amber);
    }

    /* Entity Summary */
    .entity-summary {
      font-size: 1rem;
      color: var(--text-secondary);
      margin: 1rem 0 1.5rem 0;
      line-height: 1.7;
      padding: 1rem;
      background: rgba(59, 130, 246, 0.05);
      border-radius: 8px;
      border-left: 3px solid var(--accent-blue);
    }

    .entity-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 2rem;
      margin-bottom: 2rem;
    }

    .entity-card h3 {
      margin-top: 0;
      color: var(--accent-blue);
    }

    .field-table {
      width: 100%;
      border-collapse: collapse;
      margin: 1.5rem 0;
      font-size: 0.9rem;
    }

    .field-table th {
      background: rgba(59, 130, 246, 0.1);
      border: 1px solid var(--border-subtle);
      padding: 0.75rem;
      text-align: left;
      font-weight: 600;
      color: var(--text-primary);
    }

    .field-table td {
      border: 1px solid var(--border-subtle);
      padding: 0.75rem;
      color: var(--text-secondary);
    }

    .field-table tr:hover {
      background: rgba(59, 130, 246, 0.05);
    }

    .field-name {
      font-family: 'JetBrains Mono', monospace;
      color: var(--accent-blue);
      font-weight: 500;
    }

    .field-type {
      font-family: 'JetBrains Mono', monospace;
      color: var(--accent-teal);
      font-size: 0.85rem;
    }

    .required-badge {
      display: inline-block;
      padding: 0.2rem 0.5rem;
      background: rgba(245, 158, 11, 0.2);
      border: 1px solid rgba(245, 158, 11, 0.4);
      border-radius: 4px;
      font-size: 0.75rem;
      font-family: 'JetBrains Mono', monospace;
      color: var(--accent-amber);
      margin-left: 0.5rem;
    }

    .relationship-box {
      background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(20, 184, 166, 0.1));
      border: 1px solid rgba(59, 130, 246, 0.3);
      border-radius: 8px;
      padding: 1.5rem;
      margin: 1.5rem 0;
    }

    .relationship-box h4 {
      color: var(--accent-teal);
      margin-bottom: 0.75rem;
      font-size: 1.1rem;
    }

    .relationship-box ul {
      list-style: none;
      padding-left: 0;
    }

    .relationship-box li {
      padding: 0.5rem 0;
      padding-left: 1.5rem;
      position: relative;
      color: var(--text-secondary);
    }

    .relationship-box li::before {
      content: '‚Üí';
      position: absolute;
      left: 0;
      color: var(--accent-blue);
      font-weight: bold;
    }

    code {
      font-family: 'JetBrains Mono', monospace;
      background: rgba(59, 130, 246, 0.15);
      padding: 0.2rem 0.4rem;
      border-radius: 4px;
      font-size: 0.9em;
      color: var(--accent-blue);
    }

    .footer {
      margin-top: 4rem;
      padding-top: 2rem;
      border-top: 1px solid var(--border-subtle);
      text-align: center;
    }

    .footer a {
      color: var(--accent-blue);
      text-decoration: none;
      margin: 0 1rem;
    }

    @media (max-width: 768px) {
      body {
        padding: 40px 30px;
      }

      h1 {
        font-size: 2rem;
      }

      .field-table {
        font-size: 0.8rem;
      }

      .erd-legend {
        flex-direction: column;
        gap: 1rem;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="breadcrumb">
      <a href="/dashboard.html">üè† Dashboard</a>
      <span class="separator">‚Üí</span>
      <span class="current">Data Models</span>
    </div>

    <div class="label">CONDITIONS PORTAL</div>
    <h1>üóÑÔ∏è Data Models & Relationships</h1>
    <p class="subtitle">Complete entity definitions, field specifications, and database schema</p>

    <!-- Hybrid Architecture Overview -->
    <div class="architecture-info">
      <h4>Hybrid Architecture Model</h4>
      <ul>
        <li><strong>Core Condition Data:</strong> Lives in Byte LOS (existing system) for Domo reporting compatibility and enterprise data consistency</li>
        <li><strong>Metadata & Workflow:</strong> Lives in Conditions Portal/Clear (new system) for enhanced functionality and user experience</li>
        <li><strong>Bidirectional Sync:</strong> ~30 second synchronization between systems is acceptable for operational workflow</li>
        <li><strong>Source of Truth:</strong> Conditions Portal is the authoritative source for its metadata entities (Notes, DocumentRequests, StatusHistory, ExceptionRequests, Flags)</li>
      </ul>
    </div>

    <!-- ERD Diagram -->
    <div class="erd-container">
      <div class="erd-title">Entity Relationship Diagram</div>

      <div class="erd-legend">
        <div class="legend-item">
          <div class="legend-box byte"></div>
          <span><strong>BYTE CORE</strong> - Existing Byte LOS entities</span>
        </div>
        <div class="legend-item">
          <div class="legend-box portal"></div>
          <span><strong>CONDITIONS PORTAL</strong> - New metadata entities</span>
        </div>
        <div class="legend-item">
          <div class="legend-box hybrid"></div>
          <span><strong>HYBRID</strong> - Split between both systems</span>
        </div>
      </div>

      <svg class="erd-svg" viewBox="0 0 1000 700" xmlns="http://www.w3.org/2000/svg">
        <!-- Definitions for gradients and patterns -->
        <defs>
          <linearGradient id="hybridGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style="stop-color:#3b82f6;stop-opacity:0.3" />
            <stop offset="100%" style="stop-color:#14b8a6;stop-opacity:0.3" />
          </linearGradient>
        </defs>

        <!-- Central Condition Entity (HYBRID) -->
        <g id="condition">
          <rect x="380" y="250" width="240" height="200" rx="8"
                fill="url(#hybridGradient)" stroke="#f59e0b" stroke-width="3"/>
          <text x="500" y="280" text-anchor="middle" font-size="18" font-weight="bold" fill="#f59e0b">
            CONDITION
          </text>
          <text x="500" y="300" text-anchor="middle" font-size="11" fill="#f59e0b" font-weight="600">
            [HYBRID]
          </text>
          <line x1="390" y1="310" x2="610" y2="310" stroke="#f59e0b" stroke-width="1" opacity="0.5"/>
          <text x="400" y="330" font-size="12" fill="#f1f5f9" font-family="monospace">id: UUID</text>
          <text x="400" y="348" font-size="12" fill="#f1f5f9" font-family="monospace">loanId: UUID</text>
          <text x="400" y="366" font-size="12" fill="#f1f5f9" font-family="monospace">conditionNumber</text>
          <text x="400" y="384" font-size="12" fill="#f1f5f9" font-family="monospace">name, description</text>
          <text x="400" y="402" font-size="12" fill="#f1f5f9" font-family="monospace">category, status</text>
          <text x="400" y="420" font-size="12" fill="#f1f5f9" font-family="monospace">stage, class, type</text>
          <text x="400" y="438" font-size="11" fill="#94a3b8" font-style="italic">Core in Byte + Portal</text>
        </g>

        <!-- DocumentRequest (PORTAL) -->
        <g id="documentRequest">
          <rect x="50" y="50" width="200" height="140" rx="8"
                fill="rgba(20, 184, 166, 0.2)" stroke="#14b8a6" stroke-width="2"/>
          <text x="150" y="75" text-anchor="middle" font-size="14" font-weight="bold" fill="#14b8a6">
            DocumentRequest
          </text>
          <text x="150" y="92" text-anchor="middle" font-size="9" fill="#14b8a6" font-weight="600">
            [CONDITIONS PORTAL]
          </text>
          <line x1="60" y1="100" x2="240" y2="100" stroke="#14b8a6" stroke-width="1" opacity="0.5"/>
          <text x="65" y="118" font-size="11" fill="#f1f5f9" font-family="monospace">id: UUID</text>
          <text x="65" y="133" font-size="11" fill="#f1f5f9" font-family="monospace">conditionId: UUID</text>
          <text x="65" y="148" font-size="11" fill="#f1f5f9" font-family="monospace">documentType</text>
          <text x="65" y="163" font-size="11" fill="#f1f5f9" font-family="monospace">requestedFrom[]</text>
          <text x="65" y="178" font-size="11" fill="#f1f5f9" font-family="monospace">status, dates</text>
        </g>

        <!-- Note (PORTAL) -->
        <g id="note">
          <rect x="50" y="230" width="200" height="120" rx="8"
                fill="rgba(20, 184, 166, 0.2)" stroke="#14b8a6" stroke-width="2"/>
          <text x="150" y="255" text-anchor="middle" font-size="14" font-weight="bold" fill="#14b8a6">
            Note
          </text>
          <text x="150" y="272" text-anchor="middle" font-size="9" fill="#14b8a6" font-weight="600">
            [CONDITIONS PORTAL]
          </text>
          <line x1="60" y1="280" x2="240" y2="280" stroke="#14b8a6" stroke-width="1" opacity="0.5"/>
          <text x="65" y="298" font-size="11" fill="#f1f5f9" font-family="monospace">id: UUID</text>
          <text x="65" y="313" font-size="11" fill="#f1f5f9" font-family="monospace">conditionId: UUID</text>
          <text x="65" y="328" font-size="11" fill="#f1f5f9" font-family="monospace">content: RichText</text>
          <text x="65" y="343" font-size="11" fill="#f1f5f9" font-family="monospace">createdAt, createdBy</text>
        </g>

        <!-- StatusHistory (PORTAL) -->
        <g id="statusHistory">
          <rect x="50" y="390" width="200" height="140" rx="8"
                fill="rgba(20, 184, 166, 0.2)" stroke="#14b8a6" stroke-width="2"/>
          <text x="150" y="415" text-anchor="middle" font-size="14" font-weight="bold" fill="#14b8a6">
            StatusHistory
          </text>
          <text x="150" y="432" text-anchor="middle" font-size="9" fill="#14b8a6" font-weight="600">
            [CONDITIONS PORTAL]
          </text>
          <line x1="60" y1="440" x2="240" y2="440" stroke="#14b8a6" stroke-width="1" opacity="0.5"/>
          <text x="65" y="458" font-size="11" fill="#f1f5f9" font-family="monospace">id: UUID</text>
          <text x="65" y="473" font-size="11" fill="#f1f5f9" font-family="monospace">conditionId: UUID</text>
          <text x="65" y="488" font-size="11" fill="#f1f5f9" font-family="monospace">fromStatus</text>
          <text x="65" y="503" font-size="11" fill="#f1f5f9" font-family="monospace">toStatus</text>
          <text x="65" y="518" font-size="11" fill="#f1f5f9" font-family="monospace">changedAt, changedBy</text>
        </g>

        <!-- ExceptionRequest (PORTAL) -->
        <g id="exceptionRequest">
          <rect x="750" y="50" width="200" height="160" rx="8"
                fill="rgba(20, 184, 166, 0.2)" stroke="#14b8a6" stroke-width="2"/>
          <text x="850" y="75" text-anchor="middle" font-size="14" font-weight="bold" fill="#14b8a6">
            ExceptionRequest
          </text>
          <text x="850" y="92" text-anchor="middle" font-size="9" fill="#14b8a6" font-weight="600">
            [CONDITIONS PORTAL]
          </text>
          <line x1="760" y1="100" x2="940" y2="100" stroke="#14b8a6" stroke-width="1" opacity="0.5"/>
          <text x="765" y="118" font-size="11" fill="#f1f5f9" font-family="monospace">id: UUID</text>
          <text x="765" y="133" font-size="11" fill="#f1f5f9" font-family="monospace">conditionId: UUID</text>
          <text x="765" y="148" font-size="11" fill="#f1f5f9" font-family="monospace">reason: Text</text>
          <text x="765" y="163" font-size="11" fill="#f1f5f9" font-family="monospace">status: Enum</text>
          <text x="765" y="178" font-size="11" fill="#f1f5f9" font-family="monospace">requestedBy</text>
          <text x="765" y="193" font-size="11" fill="#f1f5f9" font-family="monospace">reviewedBy, dates</text>
        </g>

        <!-- Flag (PORTAL) -->
        <g id="flag">
          <rect x="750" y="250" width="200" height="140" rx="8"
                fill="rgba(20, 184, 166, 0.2)" stroke="#14b8a6" stroke-width="2"/>
          <text x="850" y="275" text-anchor="middle" font-size="14" font-weight="bold" fill="#14b8a6">
            Flag
          </text>
          <text x="850" y="292" text-anchor="middle" font-size="9" fill="#14b8a6" font-weight="600">
            [CONDITIONS PORTAL]
          </text>
          <line x1="760" y1="300" x2="940" y2="300" stroke="#14b8a6" stroke-width="1" opacity="0.5"/>
          <text x="765" y="318" font-size="11" fill="#f1f5f9" font-family="monospace">id: UUID</text>
          <text x="765" y="333" font-size="11" fill="#f1f5f9" font-family="monospace">conditionId: UUID</text>
          <text x="765" y="348" font-size="11" fill="#f1f5f9" font-family="monospace">userId: UUID</text>
          <text x="765" y="363" font-size="11" fill="#f1f5f9" font-family="monospace">color: Enum</text>
          <text x="765" y="378" font-size="11" fill="#f1f5f9" font-family="monospace">setAt: DateTime</text>
        </g>

        <!-- Loan (BYTE) -->
        <g id="loan">
          <rect x="400" y="550" width="200" height="100" rx="8"
                fill="rgba(59, 130, 246, 0.2)" stroke="#3b82f6" stroke-width="2"/>
          <text x="500" y="575" text-anchor="middle" font-size="14" font-weight="bold" fill="#3b82f6">
            Loan
          </text>
          <text x="500" y="592" text-anchor="middle" font-size="9" fill="#3b82f6" font-weight="600">
            [BYTE CORE]
          </text>
          <line x1="410" y1="600" x2="590" y2="600" stroke="#3b82f6" stroke-width="1" opacity="0.5"/>
          <text x="415" y="618" font-size="11" fill="#f1f5f9" font-family="monospace">id: UUID</text>
          <text x="415" y="633" font-size="11" fill="#f1f5f9" font-family="monospace">loanNumber</text>
        </g>

        <!-- Relationship Lines -->

        <!-- DocumentRequest -> Condition (1:many) -->
        <path d="M 250 120 L 380 300" stroke="#14b8a6" stroke-width="2" fill="none" marker-end="url(#arrowTeal)"/>
        <text x="280" y="200" font-size="10" fill="#14b8a6" font-weight="600">1:many</text>

        <!-- Note -> Condition (1:many) -->
        <path d="M 250 290 L 380 330" stroke="#14b8a6" stroke-width="2" fill="none" marker-end="url(#arrowTeal)"/>
        <text x="290" y="310" font-size="10" fill="#14b8a6" font-weight="600">1:many</text>

        <!-- StatusHistory -> Condition (1:many) -->
        <path d="M 250 460 L 380 370" stroke="#14b8a6" stroke-width="2" fill="none" marker-end="url(#arrowTeal)"/>
        <text x="290" y="420" font-size="10" fill="#14b8a6" font-weight="600">1:many</text>

        <!-- ExceptionRequest -> Condition (0..1:1) -->
        <path d="M 750 130 L 620 300" stroke="#14b8a6" stroke-width="2" fill="none" marker-end="url(#arrowTeal)"/>
        <text x="680" y="210" font-size="10" fill="#14b8a6" font-weight="600">0..1:1</text>

        <!-- Flag -> Condition (1:many) -->
        <path d="M 750 320 L 620 340" stroke="#14b8a6" stroke-width="2" fill="none" marker-end="url(#arrowTeal)"/>
        <text x="680" y="330" font-size="10" fill="#14b8a6" font-weight="600">1:many</text>

        <!-- Condition -> Loan (many:1) -->
        <path d="M 500 450 L 500 550" stroke="#3b82f6" stroke-width="2" fill="none" marker-end="url(#arrowBlue)"/>
        <text x="510" y="500" font-size="10" fill="#3b82f6" font-weight="600">many:1</text>

        <!-- Arrow markers -->
        <defs>
          <marker id="arrowTeal" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
            <path d="M0,0 L0,6 L9,3 z" fill="#14b8a6" />
          </marker>
          <marker id="arrowBlue" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
            <path d="M0,0 L0,6 L9,3 z" fill="#3b82f6" />
          </marker>
        </defs>
      </svg>
    </div>

    <h2>Core Entities</h2>

    <div class="entity-card">
      <div class="system-badges">
        <span class="system-badge hybrid">HYBRID</span>
      </div>
      <h3>Condition</h3>
      <div class="entity-summary">
        The primary entity representing a loan condition that must be satisfied before closing. Core condition data (name, status, category, stage) lives in Byte LOS for enterprise reporting compatibility, while enhanced metadata (notes, document requests, status history) lives in the Conditions Portal. This hybrid model enables ~30 second bidirectional sync while maintaining data integrity across both systems.
      </div>

      <div class="relationship-box">
        <h4>Relationships</h4>
        <ul>
          <li><strong>One Condition</strong> has many <code>DocumentRequest[]</code></li>
          <li><strong>One Condition</strong> has many <code>Note[]</code></li>
          <li><strong>One Condition</strong> has many <code>StatusHistory[]</code></li>
          <li><strong>One Condition</strong> has many <code>Document[]</code> (uploaded files)</li>
          <li><strong>One Condition</strong> has one optional <code>ExceptionRequest</code></li>
          <li><strong>One Condition</strong> belongs to one <code>Loan</code></li>
          <li><strong>One Condition</strong> has many <code>Flag[]</code> (user-specific)</li>
        </ul>
      </div>

      <table class="field-table">
        <thead>
          <tr>
            <th>Field Name</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="field-name">id</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Unique identifier (primary key)</td>
          </tr>
          <tr>
            <td><span class="field-name">loanId</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Foreign key to Loan entity</td>
          </tr>
          <tr>
            <td><span class="field-name">conditionNumber</span></td>
            <td><span class="field-type">String</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Category-based number (e.g., "INC-001")</td>
          </tr>
          <tr>
            <td><span class="field-name">name</span></td>
            <td><span class="field-type">String(200)</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Condition title/name</td>
          </tr>
          <tr>
            <td><span class="field-name">description</span></td>
            <td><span class="field-type">Text(1000)</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Detailed condition description</td>
          </tr>
          <tr>
            <td><span class="field-name">category</span></td>
            <td><span class="field-type">Enum</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>One of 20+ categories (INC, ASSET, CRED, etc.)</td>
          </tr>
          <tr>
            <td><span class="field-name">status</span></td>
            <td><span class="field-type">Enum</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Current status (New, Requested, Cleared, etc.)</td>
          </tr>
          <tr>
            <td><span class="field-name">stage</span></td>
            <td><span class="field-type">Enum</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Loan stage: SUSP, PTD, PTF, PTP, POST, TRAIL</td>
          </tr>
          <tr>
            <td><span class="field-name">class</span></td>
            <td><span class="field-type">Enum</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>"UW" (Underwriter) or "Processor III"</td>
          </tr>
          <tr>
            <td><span class="field-name">type</span></td>
            <td><span class="field-type">Enum</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>"INT" (Internal) or "BRW" (Borrower-facing)</td>
          </tr>
          <tr>
            <td><span class="field-name">expirationDate</span></td>
            <td><span class="field-type">Date</span></td>
            <td>Optional</td>
            <td>Date when condition expires</td>
          </tr>
          <tr>
            <td><span class="field-name">followUpDate</span></td>
            <td><span class="field-type">Date</span></td>
            <td>Optional</td>
            <td>Date for follow-up action</td>
          </tr>
          <tr>
            <td><span class="field-name">createdAt</span></td>
            <td><span class="field-type">DateTime</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Timestamp of creation</td>
          </tr>
          <tr>
            <td><span class="field-name">createdBy</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>User who created the condition</td>
          </tr>
          <tr>
            <td><span class="field-name">updatedAt</span></td>
            <td><span class="field-type">DateTime</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Timestamp of last update</td>
          </tr>
          <tr>
            <td><span class="field-name">updatedBy</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>User who last updated the condition</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="entity-card">
      <div class="system-badges">
        <span class="system-badge portal">CONDITIONS PORTAL</span>
      </div>
      <h3>DocumentRequest</h3>
      <div class="entity-summary">
        Represents a structured request for specific documents from borrowers to satisfy a condition. Each request specifies the document type (from 16 predefined types), target borrowers, and detailed instructions. Tracks the complete lifecycle from request creation through document receipt and review, enabling clear communication and audit trails between processors, underwriters, and borrowers.
      </div>

      <div class="relationship-box">
        <h4>Relationships</h4>
        <ul>
          <li><strong>Many DocumentRequests</strong> belong to one <code>Condition</code></li>
          <li><strong>One DocumentRequest</strong> can have many <code>Document[]</code> (uploaded responses)</li>
        </ul>
      </div>

      <table class="field-table">
        <thead>
          <tr>
            <th>Field Name</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="field-name">id</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Unique identifier</td>
          </tr>
          <tr>
            <td><span class="field-name">conditionId</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Foreign key to Condition</td>
          </tr>
          <tr>
            <td><span class="field-name">documentType</span></td>
            <td><span class="field-type">Enum</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>One of 16 types (Bank Statements, W-2, etc.)</td>
          </tr>
          <tr>
            <td><span class="field-name">requestedFrom</span></td>
            <td><span class="field-type">String[]</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Borrower names (array)</td>
          </tr>
          <tr>
            <td><span class="field-name">description</span></td>
            <td><span class="field-type">RichText(1000)</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Description for borrower (rich text)</td>
          </tr>
          <tr>
            <td><span class="field-name">status</span></td>
            <td><span class="field-type">Enum</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Pending, Received, Reviewed</td>
          </tr>
          <tr>
            <td><span class="field-name">requestDate</span></td>
            <td><span class="field-type">DateTime</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>When the request was made</td>
          </tr>
          <tr>
            <td><span class="field-name">receivedDate</span></td>
            <td><span class="field-type">DateTime</span></td>
            <td>Optional</td>
            <td>When document was received</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="entity-card">
      <div class="system-badges">
        <span class="system-badge portal">CONDITIONS PORTAL</span>
      </div>
      <h3>Note</h3>
      <div class="entity-summary">
        Free-form notes attached to conditions by processors or underwriters for collaboration and documentation. Supports rich text formatting to enable clear communication of complex information, follow-up items, or clarifications. Each note is timestamped and attributed to its creator for full auditability and team coordination.
      </div>

      <div class="relationship-box">
        <h4>Relationships</h4>
        <ul>
          <li><strong>Many Notes</strong> belong to one <code>Condition</code></li>
        </ul>
      </div>

      <table class="field-table">
        <thead>
          <tr>
            <th>Field Name</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="field-name">id</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Unique identifier</td>
          </tr>
          <tr>
            <td><span class="field-name">conditionId</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Foreign key to Condition</td>
          </tr>
          <tr>
            <td><span class="field-name">content</span></td>
            <td><span class="field-type">RichText</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Rich text note content</td>
          </tr>
          <tr>
            <td><span class="field-name">createdAt</span></td>
            <td><span class="field-type">DateTime</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Timestamp of creation</td>
          </tr>
          <tr>
            <td><span class="field-name">createdBy</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>User who created the note</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="entity-card">
      <div class="system-badges">
        <span class="system-badge portal">CONDITIONS PORTAL</span>
      </div>
      <h3>StatusHistory</h3>
      <div class="entity-summary">
        Complete audit trail of all status transitions for a condition throughout its lifecycle. Captures who made each change and when, enabling compliance reporting, performance analysis, and issue investigation. Critical for understanding bottlenecks in the conditions clearance workflow and maintaining regulatory documentation requirements.
      </div>

      <div class="relationship-box">
        <h4>Relationships</h4>
        <ul>
          <li><strong>Many StatusHistory</strong> records belong to one <code>Condition</code></li>
        </ul>
      </div>

      <table class="field-table">
        <thead>
          <tr>
            <th>Field Name</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="field-name">id</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Unique identifier</td>
          </tr>
          <tr>
            <td><span class="field-name">conditionId</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Foreign key to Condition</td>
          </tr>
          <tr>
            <td><span class="field-name">fromStatus</span></td>
            <td><span class="field-type">Enum</span></td>
            <td>Optional</td>
            <td>Previous status (null on creation)</td>
          </tr>
          <tr>
            <td><span class="field-name">toStatus</span></td>
            <td><span class="field-type">Enum</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>New status</td>
          </tr>
          <tr>
            <td><span class="field-name">changedAt</span></td>
            <td><span class="field-type">DateTime</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Timestamp of change</td>
          </tr>
          <tr>
            <td><span class="field-name">changedBy</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>User who made the change</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="entity-card">
      <div class="system-badges">
        <span class="system-badge portal">CONDITIONS PORTAL</span>
      </div>
      <h3>ExceptionRequest</h3>
      <div class="entity-summary">
        Formal request by a processor to make an exception to standard underwriting rules for a specific condition. Enables documented escalation workflow where processors can request and underwriters can approve/deny exceptions with full audit trail. Each condition can have at most one active exception request to maintain clear decision-making authority.
      </div>

      <div class="relationship-box">
        <h4>Relationships</h4>
        <ul>
          <li><strong>One ExceptionRequest</strong> belongs to one <code>Condition</code> (optional, 0 or 1)</li>
        </ul>
      </div>

      <table class="field-table">
        <thead>
          <tr>
            <th>Field Name</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="field-name">id</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Unique identifier</td>
          </tr>
          <tr>
            <td><span class="field-name">conditionId</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Foreign key to Condition</td>
          </tr>
          <tr>
            <td><span class="field-name">reason</span></td>
            <td><span class="field-type">Text</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Reason for exception request</td>
          </tr>
          <tr>
            <td><span class="field-name">status</span></td>
            <td><span class="field-type">Enum</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Pending, Approved, Denied</td>
          </tr>
          <tr>
            <td><span class="field-name">requestedBy</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Processor who requested</td>
          </tr>
          <tr>
            <td><span class="field-name">requestedAt</span></td>
            <td><span class="field-type">DateTime</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Timestamp of request</td>
          </tr>
          <tr>
            <td><span class="field-name">reviewedBy</span></td>
            <td><span class="field-type">UUID</span></td>
            <td>Optional</td>
            <td>Underwriter who reviewed</td>
          </tr>
          <tr>
            <td><span class="field-name">reviewedAt</span></td>
            <td><span class="field-type">DateTime</span></td>
            <td>Optional</td>
            <td>Timestamp of review</td>
          </tr>
        </tbody>
      </table>
    </div>

    <div class="entity-card">
      <div class="system-badges">
        <span class="system-badge portal">CONDITIONS PORTAL</span>
      </div>
      <h3>Flag</h3>
      <div class="entity-summary">
        Personal, user-specific flags that allow processors and underwriters to prioritize or categorize conditions using color-coded markers. Flags are private to each user (not shared) and enable personalized workflow management without affecting team visibility. Supports Red, Blue, Yellow, Green, and None values for flexible prioritization strategies.
      </div>

      <div class="relationship-box">
        <h4>Relationships</h4>
        <ul>
          <li><strong>Many Flags</strong> belong to one <code>Condition</code></li>
          <li><strong>Each Flag</strong> is user-specific (scoped by userId)</li>
        </ul>
      </div>

      <table class="field-table">
        <thead>
          <tr>
            <th>Field Name</th>
            <th>Type</th>
            <th>Required</th>
            <th>Description</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td><span class="field-name">id</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Unique identifier</td>
          </tr>
          <tr>
            <td><span class="field-name">conditionId</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Foreign key to Condition</td>
          </tr>
          <tr>
            <td><span class="field-name">userId</span></td>
            <td><span class="field-type">UUID</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>User who set the flag</td>
          </tr>
          <tr>
            <td><span class="field-name">color</span></td>
            <td><span class="field-type">Enum</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>Red, Blue, Yellow, Green, None</td>
          </tr>
          <tr>
            <td><span class="field-name">setAt</span></td>
            <td><span class="field-type">DateTime</span></td>
            <td><span class="required-badge">REQUIRED</span></td>
            <td>When flag was set</td>
          </tr>
        </tbody>
      </table>
    </div>

    <h2>Enumerations</h2>

    <div class="entity-card">
      <h3>ConditionStatus</h3>
      <p>The workflow status of a condition.</p>
      <ul style="margin-top: 1rem; padding-left: 1.5rem;">
        <li><code>New</code> - Newly created condition</li>
        <li><code>Need Brw Request</code> - Requires document request from borrower</li>
        <li><code>Requested</code> - Documents requested from borrower</li>
        <li><code>Processor to Review</code> - Documents received, needs processor review</li>
        <li><code>Ready for UW</code> - Ready for underwriter approval</li>
        <li><code>Cleared</code> - Approved by underwriter</li>
        <li><code>Not Cleared</code> - Rejected by underwriter</li>
      </ul>
    </div>

    <div class="entity-card">
      <h3>ConditionStage</h3>
      <p>The loan stage where the condition applies.</p>
      <ul style="margin-top: 1rem; padding-left: 1.5rem;">
        <li><code>SUSP</code> - Suspended</li>
        <li><code>PTD</code> - Prior to Docs</li>
        <li><code>PTF</code> - Prior to Funding</li>
        <li><code>PTP</code> - Prior to Purchase</li>
        <li><code>POST</code> - Post-closing</li>
        <li><code>TRAIL</code> - Trailing documents</li>
      </ul>
    </div>

    <div class="entity-card">
      <h3>ConditionCategory</h3>
      <p>20+ predefined categories for organizing conditions.</p>
      <ul style="margin-top: 1rem; padding-left: 1.5rem; columns: 2;">
        <li><code>APP</code> - Appraisal</li>
        <li><code>DISC</code> - Disclosures</li>
        <li><code>CRED</code> - Credit</li>
        <li><code>INC</code> - Income</li>
        <li><code>ASSET</code> - Assets</li>
        <li><code>PROP</code> - Property</li>
        <li><code>MISC</code> - Miscellaneous</li>
        <li><code>CLSNG</code> - Closing</li>
        <li><code>TITLE</code> - Title</li>
        <li><code>GOV</code> - Government</li>
        <li><code>BOND</code> - Bond</li>
        <li><code>SP</code> - Special Property</li>
        <li><code>CONDO</code> - Condominium</li>
        <li><code>NEW CONST</code> - New Construction</li>
        <li><code>And 6 more...</code></li>
      </ul>
    </div>

    <div class="entity-card">
      <h3>DocumentType</h3>
      <p>16 predefined document types for requests.</p>
      <ul style="margin-top: 1rem; padding-left: 1.5rem; columns: 2;">
        <li><code>Appraisal</code></li>
        <li><code>Asset Statements</code></li>
        <li><code>Bank Statements</code></li>
        <li><code>Employment Verification</code></li>
        <li><code>Government ID</code></li>
        <li><code>Pay Stubs</code></li>
        <li><code>Tax Returns</code></li>
        <li><code>W-2 Forms</code></li>
        <li><code>Insurance (various)</code></li>
        <li><code>Purchase Agreement</code></li>
        <li><code>And 6 more...</code></li>
      </ul>
    </div>

    <h2>Database Schema Notes</h2>

    <div class="entity-card">
      <h3>Indexes</h3>
      <p>Recommended indexes for query performance:</p>
      <ul style="margin-top: 1rem; padding-left: 1.5rem;">
        <li><code>Condition.loanId</code> - Frequently queried to show all conditions for a loan</li>
        <li><code>Condition.status</code> - Used for filtering (Active, Need to Request, etc.)</li>
        <li><code>Condition.stage</code> - Used for grouping in the grid view</li>
        <li><code>Condition.class</code> - Used for role-based filtering (UW vs Processor)</li>
        <li><code>DocumentRequest.conditionId</code> - Foreign key join</li>
        <li><code>Note.conditionId</code> - Foreign key join</li>
        <li><code>StatusHistory.conditionId</code> - Foreign key join</li>
        <li><code>Flag.userId, Flag.conditionId</code> - Composite index for user-specific flags</li>
      </ul>
    </div>

    <div class="entity-card">
      <h3>Soft Deletes</h3>
      <p>Consider implementing soft deletes for audit purposes:</p>
      <ul style="margin-top: 1rem; padding-left: 1.5rem;">
        <li>Add <code>deletedAt</code> (nullable DateTime) to Condition, DocumentRequest, Note</li>
        <li>Filter out soft-deleted records in queries by default</li>
        <li>Retain historical data for compliance and reporting</li>
      </ul>
    </div>

    <div class="entity-card">
      <h3>Integration Considerations</h3>
      <p>External system references:</p>
      <ul style="margin-top: 1rem; padding-left: 1.5rem;">
        <li><code>Loan.byteId</code> - Reference to Byte LOS system</li>
        <li><code>Document.clearDocsId</code> - Reference to CLEAR Docs system</li>
        <li><code>User.oktaId</code> - Reference to Okta authentication</li>
      </ul>
    </div>

    <div class="footer">
      <a href="/dashboard.html">üè† Dashboard</a>
      <a href="tracts/tract-01-detailed-features.html">üìã Complete Feature Specs</a>
      <a href="https://github.com/mhansen003/saro-devops-docs" target="_blank">üìÇ GitHub</a>
    </div>
  </div>
</body>
</html>
